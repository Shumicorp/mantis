steps:
- name: 'gcr.io/cloud-builders/git'
  args: ['clone' ,'https://github.com/Shumicorp/mantis','--branch', '$BRANCH_NAME', '--single-branch']

- name: 'gcr.io/cloud-builders/docker'
  args: [
    'build', 
    '-t', 
    'gcr.io/$PROJECT_ID/mantis:$BUILD_ID',
    '-t',
    'gcr.io/$PROJECT_ID/mantis:latest',
    '.'
    ]
  dir: 'mantis'
images: [
    'gcr.io/$PROJECT_ID/mantis:$BUILD_ID',
    'gcr.io/$PROJECT_ID/mantis:latest']
    
- name: 'gcr.io/cloud-builders/kubectl'
  args: ['apply', '-f', 'app-k8s.yaml']
  env:
  - 'CLOUDSDK_COMPUTE_ZONE=europe-west1-b'
  - 'CLOUDSDK_CONTAINER_CLUSTER=my-cluster'


timeout: '1600s'
options:
  logging: CLOUD_LOGGING_ONLY
